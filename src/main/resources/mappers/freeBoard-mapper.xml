<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https:/mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="freeBoardMapper">
	<resultMap type="FreeBoard" id="freeBoardResult">
		<result column="FREE_NO" property="freeNo" />
		<result column="FREE_TITLE" property="freeTitle" />
		<result column="FREE_WRITER" property="freeWriter" />
		<result column="FREE_CONTENT" property="freeContent" />
		<result column="FREE_STATUS" property="status" />
		<result column="FREE_CREATE_DATE" property="createDate" />
		<result column="FREE_COUNT" property="count" />
		<result column="RMEM_NO" property="rmemNo" />

		<result column="ORIGIN_NAME" property="OriginName" />
		<result column="CHANGE_NAME" property="ChangeName" />

	</resultMap>
	<resultMap type="Attachment" id="attachmentResult">
		<result column="FISHING_NO" property="freeNo" />
		<result column="FISHING_TITLE" property="freeTitle" />
		<result column="FISHING_WRITER" property="freeWriter" />
		<result column="FISHING_CONTENT" property="freeContent" />
		<result column="FISHING_STATUS" property="status" />
		<result column="FISHING_CREATE_DATE" property="createDate" />
		<result column="FISHING_COUNT" property="count" />
		<result column="RMEM_NO" property="rmemNo" />
		<result column="ORIGIN_NAME" property="OriginName" />
		<result column="CHANGE_NAME" property="ChangeName" />

	</resultMap>

	<!-- 게시글의 총 갯수 조회하는 쿼리 -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		FROM
		FREEBOARD
		WHERE FREE_STATUS = 'Y'
	</select>

	<insert id="insertFreeBoard">

		INSERT INTO FREEBOARD (
		FREE_NO,
		FREE_TITLE,
		FREE_WRITER,
		FREE_CONTENT
		)
		VALUES (
		SEQ_FREE_NO.NEXTVAL,
		#{freeTitle},
		#{freeWriter},
		#{freeContent}
		)
	</insert>
	<insert id="insertAttachment">
		INSERT INTO ATTACHMENT (
		FILE_NO
		,REF_BNO
		,ORIGIN_NAME
		,CHANGE_NAME
		,FILE_PATH
		)
		VALUES (
		SEQ_FILE_NO.NEXTVAL,
		SEQ_FREE_NO.CURRVAL,
		#{ORIGIN_NAME},
		#{CHANGE_NAME},
		#{FilePath}
		)
	</insert>

	<!-- 게시글 조회 쿼리문 -->
	<select id="selectList" resultMap="freeBoardResult">
		SELECT FREE_NO
		,FREE_TITLE
		,FREE_WRITER
		,FREE_COUNT
		,TO_CHAR(FREE_CREATE_DATE, 'YYYY-MM-DD') AS
		"FREE_CREATE_DATE"
		FROM FREEBOARD
		WHERE FREE_STATUS = 'Y'
		ORDER BY
		FREE_NO DESC
	</select>

	<update id="increaseCount">
		UPDATE FREEBOARD
		SET FREE_COUNT = FREE_COUNT + 1
		WHERE
		FREE_NO = #{freeNo}
		AND FREE_STATUS = 'Y'
	</update>

	<select id="selectBoard" resultMap="freeBoardResult">
		SELECT FREE_NO
		,FREE_TITLE
		,FREE_WRITER
		,FREE_CONTENT
		,FREE_STATUS
		,FREE_CREATE_DATE
		,FREE_COUNT
		,TO_CHAR(FREE_CREATE_DATE, 'YYYY-MM-DD') AS "CREATE_DATE"
		FROM
		FREEBOARD
		WHERE FREE_STATUS = 'Y'
		AND FREE_NO = #{freeNo}
	</select>

	<update id="updateFreeBoard">
	  UPDATE FREEBOARD
	  		SET FREE_TITLE = #{freeTitle},
	  			FREE_CONTENT = #{freeContent}
	  			
	  	WHERE FREE_NO = #{freeNo}
  </update>
  	
  	<!-- 통합 검색을 위해 만든 것 -고이환- -->
  	<select id="selectFreeList" resultMap="freeBoardResult">
  		SELECT FREE_NO,
  			   FREE_TITLE
  		  FROM FREEBOARD
  		WHERE FREE_STATUS = 'Y'
  		AND FREE_TITLE LIKE '%' || #{keyword} || '%'
  		AND ROWNUM &lt;= 2
  	</select>

		UPDATE FREEBOARD
		SET FREE_TITLE = #{freeTitle},
		FREE_CONTENT = #{freeContent}

		WHERE FREE_NO = #{freeNo}
	</update>

	<update id="deleteBoard">
		UPDATE FREEBOARD
		SET FREE_STATUS = 'N'
		WHERE FREE_NO = #{freeNo}
	</update>

	<select id="selectSearchListCount" resultType="_int">
		SELECT COUNT(*)
		FROM FREEBOARD
		WHERE FREE_STATUS = 'Y'
		<if test="condition == 'fTitle'">
			AND FREE_TITLE
		</if>
		<if test="condition == 'fwriter'">
			AND FREE_WRITER
		</if>
		LIKE '%' || #{keyword} || '%'
	</select>

	<select id="selectSearchList" resultMap="freeBoardResult">
		SELECT FREE_NO
       ,FREE_TITLE
       ,FREE_COUNT
       ,FREE_WRITER
       ,FREE_CREATE_DATE
FROM FREEBOARD 
WHERE FREE_STATUS = 'Y'
		<choose>
			<when test="condition == 'fTitle'">
				AND FREE_TITLE
			</when>
			<otherwise>
				AND FREE_WRITER
			</otherwise>
		</choose>
		LIKE '%' || #{keyword} || '%'
		ORDER BY FREE_NO DESC
	</select>

</mapper>
